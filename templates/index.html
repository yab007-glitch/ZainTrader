<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAIN TRADER ⚡️</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #141414;
            --text: #e0e0e0;
            --accent: #00ff9d;
            --danger: #ff4757;
            --muted: #444;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; margin: 0; padding: 20px; }
        h1 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid #222; }
        .price { font-size: 1.5em; font-weight: bold; }
        .trend-UP { color: var(--accent); }
        .trend-DOWN { color: var(--danger); }
        .status-badge { font-size: 0.5em; background: #333; padding: 5px 10px; border-radius: 4px; }
        .btn { background: var(--accent); color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn:hover { opacity: 0.8; }
        .btn-stop { background: var(--danger); color: #fff; }
        #trades-list { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>
        <span>ZAIN TRADER ⚡️</span>
        <span id="system-status" class="status-badge">OFFLINE</span>
    </h1>

    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="startBot()">Initialize System</button>
        <button class="btn btn-stop" onclick="stopBot()">Terminate</button>
    </div>

    <h2>Live Market Data</h2>
    <div id="market-grid" class="grid">
        <!-- JS injects here -->
        <div class="card">Waiting for stream...</div>
    </div>

    <h2>Active Positions</h2>
    <div id="trades-list" class="grid">
        <!-- JS injects here -->
    </div>

    <script>
        function updateUI() {
            fetch('/api/state')
                .then(r => r.json())
                .then(data => {
                    // Update Status
                    const statusBadge = document.getElementById('system-status');
                    statusBadge.innerText = data.status || "OFFLINE";
                    statusBadge.style.color = data.status === "Running" ? "var(--accent)" : "var(--muted)";

                    // Update Market Grid
                    if (data.latest_data) {
                        const grid = document.getElementById('market-grid');
                        grid.innerHTML = '';
                        Object.keys(data.latest_data).forEach(pair => {
                            const info = data.latest_data[pair];
                            const trendClass = `trend-${info.trend}`;
                            grid.innerHTML += `
                                <div class="card">
                                    <div style="color: #888; font-size: 0.8em;">${pair}</div>
                                    <div class="price ${trendClass}">${info.price.toFixed(5)}</div>
                                    <div style="margin-top: 10px; font-size: 0.9em;">
                                        RSI: <span style="color: ${info.rsi > 70 || info.rsi < 30 ? 'orange' : '#fff'}">${info.rsi}</span><br>
                                        Trend: <span class="${trendClass}">${info.trend}</span>
                                    </div>
                                </div>
                            `;
                        });
                    }

                    // Update Trades
                    if (data.active_trades) {
                        const list = document.getElementById('trades-list');
                        list.innerHTML = '';
                        if (data.active_trades.length === 0) {
                            list.innerHTML = '<div style="color: #666;">No active positions. Scanning...</div>';
                        } else {
                            data.active_trades.forEach(trade => {
                                list.innerHTML += `
                                    <div class="card" style="border-left: 3px solid var(--accent)">
                                        <div>${trade.instrument}</div>
                                        <div>${trade.units > 0 ? 'LONG' : 'SHORT'}</div>
                                        <div>PnL: ${trade.unrealizedPL}</div>
                                    </div>
                                `;
                            });
                        }
                    }
                });
        }

        function startBot() {
            fetch('/api/start', { method: 'POST' })
                .then(r => r.json())
                .then(d => alert(d.message));
        }

        function stopBot() {
            fetch('/api/stop', { method: 'POST' })
                .then(r => r.json())
                .then(d => alert(d.message));
        }

        setInterval(updateUI, 2000);
    </script>
</body>
</html>
